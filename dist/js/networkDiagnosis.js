$(document).ready(function(){translate();bindBtnEvent();getDiagnosisInfo();parent.autoHeight()});function translate(){$("#netDiagTitle").text(top.T_ZH.NetworkDiagnosis.NetDiagTitle);$("#startDiagBtn").text(top.T_ZH.NetworkDiagnosis.StartDiag);$("#ipFilterLabel").text(top.T_ZH.NetworkDiagnosis.IpAddress);$("#diagResultLabel").text(top.T_ZH.NetworkDiagnosis.DiagResultLabel)}function bindBtnEvent(){$("#startDiagBtn").click(function(a){a.preventDefault();startDiag();parent.autoHeight()})}function startDiag(){var b=$("#ipFilter").val().replace(/ /g,"");var c=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;if(b!=""&&!c.test(b)){top.ModalCommon.open(top.T.Main.Notice,top.T.NetworkDiagnosis.IpAddressError,"error");return}var a='networkDiagnosis DiagParam:DestIpAddress="'+b+'";';top.LMT.cmdSyn(a,function(d){if(top.LMT.isCmdSuccess(d)){getDiagnosisInfo()}else{top.ModalCommon.open(top.T.Main.Notice,top.T.NetworkDiagnosis.StartDiagFail,"error")}})}function getDiagnosisInfo(){var c=false;var a="get NetworkDiagMgmt;";var b="web getFile:path=/OAM/software/web/web_page/networkDiagnosis.txt;";top.LMT.cmdSyn(a,function(f){var d=top.LMT.parser(f);if(d.result==="000"){for(var e=0;e<d.name_val.length;e++){if("NetworkDiagState"==d.name_val[e].name&&"0"==d.name_val[e].val){c=true}}}if(c){top.LMT.cmdSyn(b,function(g){if(top.LMT.isCmdSuccess(g)){parseDiagnosisInfo(g);top.ModalCommon.delProgress()}else{createDiagReport([]);top.ModalCommon.delProgress()}})}else{setTimeout(function(){getDiagnosisInfo();setTimeout(arguments.callee,5*1000)},5*1000);top.ModalCommon.progress(top.T.NetworkDiagnosis.StartDiagLoading)}})}function parseDiagnosisInfo(a){var a=top.LMT.parser(a);var b=a.content;var c=b.indexOf("TIME:");b=c!=-1?b.substring(c,b.length-1):"";if(b.length>0){b=b.split("\n");createDiagReport(b)}}function createDiagReport(a){var b=[];var f=true,d="";var e=/^TIME:(.*) RESULT:(.*) SUMMARY:(.*)$/;for(var c=0;c<a.length;c++){if(e.test(a[c])){f&=(RegExp.$2=="Success");d=(RegExp.$1).substring(0,4)+"-"+(RegExp.$1).substring(4,6)+"-"+(RegExp.$1).substring(6,8)+" "+(RegExp.$1).substring(8,10)+":"+(RegExp.$1).substring(10,12)+":"+(RegExp.$1).substring(12,14);b.push('<div class="task medium">');b.push(' <div class="desc">');b.push('     <div class="title">第',c+1,"步：</div>");b.push('     <div class="diagnosisContent">',RegExp.$3,"</div>");b.push(" </div>");b.push(' <div class="time">');b.push('     <div class="date">',(RegExp.$2=="Success"?'<span class="label label-success">Success</span>':'<span class="label label-important">Failure</span>'),"</div>");b.push('     <div class="diagnosisTime">',d,"</div>");b.push(" </div>");b.push("</div>")}}if(b.length==0){var b=[];clearDiagResult();b.push('<div class="task medium last">');b.push(' <div class="desc">');b.push('     <div class="title"></div>');b.push('     <div class="diagnosisContent">没有记录</div>');b.push(" </div>");b.push(' <div class="time">');b.push('     <div class="date"></div>');b.push('     <div class="diagnosisTime"></div>');b.push(" </div>");b.push("</div>")}else{$("#diagResult").text("诊断时间："+d+(f?" 网络通畅":" 网络故障"));$("#diagResult").attr("class",f?"green":"red");$("#diagResult").show()}$("#diagDetail").empty().append(b.join(""))}function clearDiagResult(){$("#diagResult").text("");$("#diagResult").attr("class","");$("#diagResult").hide()};