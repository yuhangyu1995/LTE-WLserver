var logTab=new TABLE(1,1,"logTab","paramList"),timer;if(typeof top.AutoRefresh_flag==="undefined"){top.AutoRefresh_flag=true}if(typeof top.AutoMonitor_flag==="undefined"){top.AutoMonitor_flag=false}if(typeof top.search==="undefined"){top.search=[]}$(document).ready(function(){onlineorNo();translate();getLog();init();bindBtnEvent();bindToolTip()});function translate(){$("#ImsiLog").text(top.T.ImsiLog.ImsiLog)}function getLog(){var a="web getFile:path=/OAM/software/web/web_page/IMEI.imei;";parent.LMT.cmdSyn(a,function(c){if(parent.LMT.isCmdSuccess(c)){var b=[];b=dataParse(c);showLog(b)}else{}})}function dataParse(o){var a=parent.LMT.parser(o),b=a.content,d,g,h="",r="",k=[],n=/^NO:(.*) IMSI:(.*) IMEI:(.*) *TIME:(\d{14}) MODE:(.*) *(.*)$/,m=[],p=[],l=[],f=[],q=[],e=[],c=b.indexOf("NO:");c===-1?h="":h=b.substring(c,b.length-1);if(h.length>0){h=h.split("\n");for(d=0,g=h.length;d<g;d+=1){if(n.test(h[d])){m.push(RegExp.$1);f.push(RegExp.$2);e.push(RegExp.$3.replace(" ",""));q.push(RegExp.$4);l.push(RegExp.$5)}}r=navigator.userAgent;if(f.length>2000&&/MSIE ([^;]+)/.test(r)){f=f.slice(length-2000)}for(d=0,g=f.length;d<g;d++){p[d]=q[d].substring(0,4)+"-"+q[d].substring(4,6)+"-"+q[d].substring(6,8)+"-"+q[d].substring(8,10)+":"+q[d].substring(10,12)+":"+q[d].substring(12);k[d]=[m[d],f[d],e[d],l[d],p[d]]}return k}else{k=[];return k}}function showLog(c){var b="",a=new Array(top.T.ParamView.Index,top.T.LogManagement.IMSIInfo,top.T.LogManagement.IMEIInfo,top.T.LogManagement.Mode,top.T.Alarm.EventTime);logTab.cols=a.length;logTab.data_reload_sw=0;logTab.menuPos=2;logTab.EMPTY();chunk(c,pushTable);logTab.rowID=0;logTab.title_space=["10%","15%","15%","15%","15%"];logTab.view_width=1024;logTab.SET_TITLE(a.toString())}function chunk(a,c,b){setTimeout(function(){var d=[];d=a.length>1000?a.splice(0,1000):a.splice(0,a.length);c.call(b,d);if(a.length>0){setTimeout(arguments.callee,100)}html=logTab.SHOW_TABLE();$("#container").append(html);a_layout();logTab.JUMP("last");parent.autoHeight()},100)}function pushTable(a){if(a&&a.length>0){for(var b=0,c=a.length;b<c;b++){logTab.PUSH_MULTI_DATA(a[b])}}else{logTab.PUSH_MULTI_DATA([])}}function init(){var c="",a,b;window.setTimeout(function(){if(top.AutoMonitor_flag){for(a=0,b=top.search.length;a<b;a++){c+=top.search[a]+","}$("#IMEI_IMSI").val(c);getSearchData()}else{clearTimeout(timer);timer=window.setTimeout(function(){if(top.AutoRefresh_flag===true){getLog()}else{return}window.setTimeout(arguments.callee,10*1000)},10*1000)}},100)}function bindBtnEvent(){$(".btn-stoprefresh").click(function(a){a.preventDefault();if(top.AutoMonitor_flag){return}if(top.AutoRefresh_flag){$("i",$(this)).removeClass("off").addClass("retweet");$(this).removeClass("btn-stoprefresh").addClass("btn-autorefresh")}else{$("i",$(this)).removeClass("retweet").addClass("off");$(this).removeClass("btn-autorefresh").addClass("btn-stoprefresh")}if(top.AutoRefresh_flag){top.AutoRefresh_flag=false}else{top.AutoRefresh_flag=true;clearTimeout(timer);timer=window.setTimeout(function(){if(top.AutoRefresh_flag){getLog()}else{return}window.setTimeout(arguments.callee,10*1000)},10*1000)}bindToolTip()});$(".btn-refresh").click(function(a){a.preventDefault();if(top.AutoMonitor_flag){return}getLog();top.ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.OperationSuccess,"ok")});$(".btn-trash").click(function(a){a.preventDefault();if(top.AutoMonitor_flag){return}top.LMT.cmdSyn("ClearImsi;",function(b){getLog()});top.ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.OperationSuccess,"ok")});$(".btn-monitor-off").click(function(a){a.preventDefault();if(top.AutoMonitor_flag){top.AutoMonitor_flag=false;$("i",$(this)).removeClass("stop").addClass("play");$(this).removeClass("btn-monitor-on").addClass("btn-monitor-off");getLog()}else{top.AutoMonitor_flag=true;getData();if(top.AutoMonitor_flag){getSearchData();$("i",$(this)).removeClass("play").addClass("stop");$(this).removeClass("btn-monitor-off").addClass("btn-monitor-on")}}bindToolTip()});$(".btn-minimize").click(function(b){b.preventDefault();var a=$(this).parent().parent().next(".box-content");if(a.is(":visible")){$("i",$(this)).removeClass("chevron-up").addClass("chevron-down");$(this).removeClass("btn-minimize").addClass("btn-maximize")}else{$("i",$(this)).removeClass("chevron-down").addClass("chevron-up");$(this).removeClass("btn-maximize").addClass("btn-minimize")}bindToolTip();a.slideToggle();parent.autoHeight()});$("#IMEI_IMSI").keydown(function(b){if(b.keyCode=="13"){var a=$(".btn-monitor-off")[0]?$(".btn-monitor-off"):$(".btn-monitor-on");a.click()}})}function bindToolTip(){$(".btn-autorefresh").attr("data-original-title",top.T.BTN.TurnOnAutoRefresh);$(".btn-stoprefresh").attr("data-original-title",top.T.BTN.TurnOffAutoRefresh);$(".btn-refresh").attr("data-original-title",top.T.BTN.Refresh);$(".btn-trash").attr("data-original-title",top.T.LogManagement.ClearImsi);$(".btn-monitor-on").attr("data-original-title",top.T.LogManagement.Auto_monitor_off);$(".btn-monitor-off").attr("data-original-title",top.T.LogManagement.Auto_monitor_on);$(".btn-minimize").attr("data-original-title",top.T.BTN.Minimize);$(".btn-maximize").attr("data-original-title",top.T.BTN.Maximize);$('[rel="tooltip"],[data-rel="tooltip"]').tooltip({"placement":"bottom",delay:{show:400,hide:200}})}function getData(){var a=[],c=/^\d+$/,d=$("#IMEI_IMSI").val()+",";d.replace(" ",",");d.replace("ï¼Œ",",");a=d.split(",");top.search=[];for(var b=0;b<a.length;b++){if(c.test(a[b])){top.search.push(a[b])}}if(top.search.length===0){top.AutoMonitor_flag=false;top.ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.IMSIInputError,"error")}}function getSearchData(){if(top.AutoRefresh_flag===true){top.AutoRefresh_flag=false;$(".halflings-icon.off").removeClass("off").addClass("retweet");$(".btn-stoprefresh").removeClass("btn-stoprefresh").addClass("btn-autorefresh");bindToolTip()}getData_Auto();clearTimeout(timer);timer=window.setTimeout(function(){if(top.AutoMonitor_flag){getData_Auto()}else{return}window.setTimeout(arguments.callee,10*1000)},10*1000)}function getData_Auto(){var a=[],g=[],c,d,e,f,b="web getFile:path=/OAM/software/web/web_page/IMEI.imei;";parent.LMT.cmdSyn(b,function(h){if(parent.LMT.isCmdSuccess(h)){g=dataParse(h);for(c=0,d=top.search.length;c<d;c++){for(e=0,f=g.length;e<f;e++){if(g[e][1].indexOf(top.search[c])!=-1){a.push(g[e])}else{if(g[e][2].indexOf(top.search[c])!=-1){a.push(g[e])}else{}}}}a=clearRedundance(a);showLog(a)}})}function clearRedundance(a){var a=a||[],b,c,d,e=[],f=true;for(b=0;b<a.length;b++){if(e.length===0){e.push(a[b])}else{for(c=0,d=e.length;c<d;c++){if(a[b]===e[c]){f=false;break}}f?e.push(a[b]):f=true}}for(c=0,d=e.length;c<d;c++){e[c][0]=c+1}return e}$(window).resize(function(){a_layout()});function a_layout(){$("#y_scroll").css("height","auto");$("#y_scroll").css("visibility","visible")};