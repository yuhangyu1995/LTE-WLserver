var System=(function(){function g(){var m="list package;",n=LMT.cmdAsyn(m);return LMT.parser(n)}function a(n){var m='active package : version = "'+n+'";';ModalCommon.progress();LMT.cmdSyn(m,function(p){var o=LMT.parser(p);if(o.result==="000"){ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.VersionActiveSuccessInfo,"ok");Progress.reBooting()}else{ModalCommon.delProgress();ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.VersionActiveFailureInfo,"error")}})}function e(){var m="",n="";if(USER.hasModule(Branch.Modules.VxWorks)){m='export database: path = "/ram0/OAM/software/param.xml";'}else{m='export database: path = "/OAM/software/param.xml";'}n=LMT.cmdAsyn(m);return LMT.parser(n)}function l(){var m;if(USER.hasModule(Branch.Modules.VxWorks)){m=LMT.cmdAsyn("web zipPackage:/ram0/OAM/software/param.xml /ram0/OAM/software/web/web_page/param.zip;")}else{m=LMT.cmdAsyn("web zipPackage:/OAM/software/param.xml /OAM/software/web/web_page/param.zip;")}return parent.LMT.parser(m)}function j(n){ModalCommon.progress();var m='import database: path = "'+n+'"';ModalCommon.progress(top.T.AlertInfo.Importing);LMT.cmdSyn(m,function(p){ModalCommon.delProgress();var o=LMT.parser(p),r="general/pages/bkpRef.asp",q=null;if(o.result==="000"){ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.ImportSuccess,"ok")}else{ModalCommon.open(top.T.Main.Notice,o.hint,"error")}q=document.getElementById("contentMainFrame");q.src=r+"?r="+DeviceInfo.getPartialVersion()})}function b(n){var m='download complete : path = "'+n+'";';LMT.cmdSyn(m,c)}function c(n){if(-1!=n.indexOf("update_exception_sucess")){setTimeout(Progress.updateReboot,20000);return}var m=LMT.parser(n),p="general/pages/verCtrl.asp",o=document.getElementById("contentMainFrame");if(m.result==="000"){Progress.updateReboot()}else{ModalCommon.delProgress();ModalCommon.open(top.T.Main.Notice,m.hint,"error");o.src=p+"?r="+DeviceInfo.getPartialVersion()}}function f(){var m="get lmtCommands;",n=LMT.cmdAsyn(m);return LMT.parser(n)}function h(){var m="get UserCommands;",n=LMT.cmdAsyn(m);return LMT.parser(n)}function d(m){var n="download request;";LMT.cmdSyn(n,m)}function k(m){if(typeof(m)==="undefined"){ModalCommon.open(top.T.AlertInfo.LogoutConfirm,top.T.AlertInfo.LogoutMSG,"choice",k);return}if(window.parseInt(m)===1){var n=GetCookie("role");$.post("/req/authReq.asp",{reqType:2,role:n},function(o){DelCookie("loginFlag");window.top.location="login.asp"})}}function i(n){var m='download certificate: path = "'+n+'"';ModalCommon.progress(top.T.AlertInfo.Importing);LMT.cmdSyn(m,function(p){var o=LMT.parser(p),q=document.getElementById("contentMainFrame");ModalCommon.delProgress();if(o.result==="000"){ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.ImportSuccess,"ok")}else{ModalCommon.open(top.T.Main.Notice,o.hint,"error")}q.src="general/pages/bkpRef.asp?v=?"+DeviceInfo.getPartialVersion()})}return{getSWpackageVersion:g,activePackage:a,exportDatabase:e,importDatabase:j,zipExportPackage:l,dlComplete:b,getLmtCommands:f,getUserCommands:h,downloadRequest:d,logout:k,importCertrificate:i}}());var Progress=(function(){function h(r){if(typeof(r)==="undefined"){ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.ResetSystemConfirm,"choice",Progress.reBoot);return}if(window.parseInt(r)===1){ModalCommon.progress(top.T.AlertInfo.Rebooting);var q="reboot;";$("#contentMainFrame").attr("src","");LMT.cmdSyn(q,function(t){var s=LMT.parser(t);if(s.result!="000"){ModalCommon.delProgress();ModalCommon.open(top.T.Main.Notice,s.hint,"error")}setTimeout(b,1000*60)})}}function i(){ModalCommon.progress(top.T.AlertInfo.Updating);setTimeout(b,1000*60)}var f="/req/pendingReq.asp",g="/general/pages/pendingReq.asp",k=f;function b(){$("#contentMainFrame").attr("src","");var q=-1;setTimeout(function(){$.ajax({async:true,cache:false,type:"post",timeout:2000,url:k,data:{"usecond":1},success:function(r){clearTimeout(q);setTimeout(p,1000*20)},error:function(){k=(k===f)?g:f;q=setTimeout(b,2000)}})},2000)}function p(){$.ajax({async:true,cache:false,type:"post",timeout:1000*11,url:"/req/generalReq.asp",data:{"caseType":6},success:function(q){ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.GotoMainPageInfo,"choice",function(r){if(window.parseInt(r)===1){window.top.location.reload()}else{System.logout(1)}})},error:function(){ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.GotoHomePageInfo,"ok",function(q){DelCookie("loginFlag");window.top.location="login.asp"+"?r="+parseInt((100*Math.random()),10)})}})}function j(){var q=URLManager.getURL();ModalCommon.delProgress();$("#contentMainFrame").attr("src",q)}function o(){ModalCommon.progress();var q=[];q.push(top.T.VersionManagementPage.FirewareUploadFinished);q.push(top.T.VersionManagementPage.FirewareChecked);q.push(top.T.VersionManagementPage.FirewareFinished);ModalCommon.showSteps(q);$.ajaxSetup({async:true,timeout:1000});setTimeout(b,40000)}var e=0,d=false,c;function m(q){d=false;e=0;ModalCommon.progress();c=setInterval(function(){n(q)},2000)}function n(q){e+=1;if(e>300){clearInterval(c);ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.FileUploadTimeout,"error")}$.ajax({type:"post",async:true,url:"/req/transferReq.asp",data:{caseType:1},success:function(r){clearInterval(c);if(1===window.parseInt(r)){setTimeout(function(){a(q)},5000)}else{if(e>300){ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.FileUploadTimeout,"error")}}}})}function a(q){if(!d){$.ajax({type:"post",async:true,url:"/req/transferReq.asp",data:{caseType:2},success:function(r){r=r.split("|");if(!r||r.length<2){a(q)}else{l(r[0],r[1],r[2],q)}},error:function(){a(q)}})}}function l(s,t,r,q){d=true;clearInterval(c);if(typeof(q)==="undefined"){q=0}else{q=window.parseInt(q,10)}if(1===q){ModalCommon.showSteps([top.T.VersionManagementPage.FirewareUploadFinished,top.T.VersionManagementPage.FirewareChecking])}else{if(2===q){ModalCommon.delProgress()}}s=window.parseInt(s,10);if(0===s){if(-1!==t.indexOf("webupdateUpload",0)){System.dlComplete(r)}else{if((-1!==t.indexOf("webLmtUpload",0))||(-1!==t.indexOf("uploadlmtlist.txt",0))){ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.ScriptUploadSuccess,"ok");j()}else{if(-1!==t.indexOf("webImportInOutUpload",0)){System.importDatabase(r)}else{if(-1!==t.indexOf("webCacUpload",0)){System.importCertrificate(r)}else{ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.SoftwareUploadSuccess,"ok");j()}}}}}else{switch(window.parseInt(s)){case -1:ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.InvalidFile,"error");break;case -2:ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.TruncateFileFail,"error");break;case -3:ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.TruncateFileFail,"error");break;case -4:ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.FileRenameFail,"error");break;case -5:ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.SpaceError,"error");break;case -6:ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.FlashSpaceError,"error");break;default:break}j()}}return{submit_upload:l,updateFeller:m,updateReboot:o,reLoadChildPage:j,reBooting:i,reBoot:h}}());var Alarm=(function(){function a(){var d="get CurrentAlarms;",e=LMT.cmdAsyn(d);return LMT.parser(e)}function b(){var d="get HistoryAlarms;",e=LMT.cmdAsyn(d);return LMT.parser(e)}function c(g,h,d){var e='raise alarm : id = "'+g+'", state = "'+h+'", cause = "'+d+'";';var f=LMT.cmdAsyn(e);return LMT.parser(f)}return{getCurrentAlarms:a,getHistoryAlarms:b,raiseAlarm:c}}());