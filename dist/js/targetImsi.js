$(document).ready(function(){IMSI_EDIT.open();bindBtnEvent()});function bindBtnEvent(){$(".btn-refresh").click(function(a){a.preventDefault();IMSI_EDIT.open();bindBtnEvent();top.ModalCommon.open(top.T.Main.Notice,top.T.AlertInfo.OperationSuccess,"ok")});$(".btn-minimize").click(function(b){b.preventDefault();var a=$(this).parent().parent().next(".box-content");if(a.is(":visible")){$("i",$(this)).removeClass("chevron-up").addClass("chevron-down");$(this).removeClass("btn-minimize").addClass("btn-maximize")}else{$("i",$(this)).removeClass("chevron-down").addClass("chevron-up");$(this).removeClass("btn-maximize").addClass("btn-minimize")}bindToolTip();a.slideToggle();parent.autoHeight()})}function bindToolTip(){$(".btn-refresh").attr("data-original-title",top.T.BTN.Refresh);$(".btn-minimize").attr("data-original-title",top.T.BTN.Minimize);$(".btn-maximize").attr("data-original-title",top.T.BTN.Maximize);$('[rel="tooltip"],[data-rel="tooltip"]').tooltip({"placement":"bottom",delay:{show:400,hide:200}})}var IMSI_EDIT=(function(){var b="";function e(){var k=" get TargetImsiParam;";var o=top.LMT.cmdAsyn(k);var j=top.LMT.parser(o);if(j.result==="000"){for(var m=0;m<j.name_val.length;m++){if("TargetImsiList"==j.name_val[m].name){b=j.name_val[m].val}}}var l=[];l.push('<div class="box span12">');l.push('    <div class="box-header">');l.push('        <h2 style="cursor: context-menu;text-shadow: 0px 0px #fff;"><i class="halflings-icon list"></i><span class="break"></span>目标列表</h2>');l.push('        <div class="box-icon">');l.push('		   		<a href="#" class="btn-refresh" data-rel="tooltip" data-original-title=""><i class="halflings-icon refresh"></i></a>');l.push('		   		<a href="#" class="btn-minimize" data-rel="tooltip" data-original-title=""><i class="halflings-icon chevron-up"></i></a>');l.push("        </div>");l.push("    </div>");l.push('    <div class="box-content">');l.push('    <div class="span8" style="color: rebeccapurple;">编辑完成后请点击【保存】按钮！</div>');l.push('    <div class="span4">');l.push('        <div class="control-group success" style="margin-left: 13%;display: inline-block;">');l.push('            <div class="controls">');l.push('                <input type="text" style="margin: 0px;" placeholder="请输入要新增的IMSI（15位数字）">');l.push('                <a class="btn btn-danger" href="#" data-rel="tooltip" data-original-title="新增" onclick="IMSI_EDIT.add(event, this)"> <i class="icon-plus white"></i></a>');l.push("            </div>");l.push("         </div>");l.push('         <button type="submit" class="btn btn-success" onclick="IMSI_EDIT.imsi_save(event)">保存</button>');l.push("    </div>");l.push('        <table class="table table-striped table-bordered bootstrap-datatable datatable" style="color: #468847;">');l.push("            <thead>");l.push("                <tr>");l.push('                    <th class="span2">序号</th>');l.push('                    <th class="span3">目标IMSI</th>');l.push('                    <th class="span3">有效状态</th>');l.push('                    <th class="span4">操作选项</th>');l.push("                </tr>");l.push("            </thead>");l.push('            <tbody id="imsi_edit_body">');if(b.length>0){var n=b.split(",");for(var m=0;m<n.length;m++){l.push("         <tr>");l.push('             <td class="span2 center">',m+1,"</td>");l.push('             <td class="span3 center imsi">',n[m],"</td>");l.push('             <td class="span3 center imsi-status valid"><span class="label label-success">有效</span></td>');l.push('             <td class="span4 center">');l.push('                 <a class="btn btn-success" href="#" data-rel="tooltip" data-original-title="恢复" onclick="IMSI_EDIT.valid(event, this)"> <i class="icon-undo white"></i></a>');l.push('                 <a class="btn btn-info" href="#" data-rel="tooltip" data-original-title="编辑" onclick="IMSI_EDIT.edit(event, this)"> <i class="icon-edit white"></i></a>');l.push('                 <a class="btn btn-danger" href="#" data-rel="tooltip" data-original-title="删除" onclick="IMSI_EDIT.invalid(event, this)"> <i class="icon-trash white"></i></a>');l.push('                 <div class="control-group success imsi_edit" style="display: none;">');l.push('                     <div class="controls">');l.push('                         <input type="text" style="margin: 0px;" placeholder="请输入要替换的IMSI（15位数字）" onblur="IMSI_EDIT.save(event, this)">');l.push("                     </div>");l.push("                 </div>");l.push("             </td>");l.push("         </tr>")}}l.push("            </tbody>");l.push("        </table>");l.push("    </div>");l.push("</div>");$("#imsi_edit").empty().append(l.join(""))}function g(){$("#imsi_edit").empty();e();$("#imsi_edit").slideDown("slow");$('[rel="tooltip"],[data-rel="tooltip"]').tooltip({"placement":"bottom",delay:{show:400,hide:200}})}function i(j,k){j.preventDefault();var l=$(k).parent().parent();$(".imsi",$(l)).css("text-decoration","");$(".imsi-status",$(l)).empty().append('<span class="label label-success">有效</span>');$(".imsi-status",$(l)).removeClass("invalid").addClass("valid")}function f(j,k){j.preventDefault();var l=$(k).parent().parent();$(".imsi",$(l)).css("text-decoration","line-through");$(".imsi-status",$(l)).empty().append('<span class="label label-important">待删除</span>');$(".imsi-status",$(l)).removeClass("valid").addClass("invalid")}function c(j,k){j.preventDefault();$(".imsi_edit",$(k).parent()).css({"margin-bottom":"0px","display":"inline-block"});$(".imsi_edit",$(k).parent()).children().children().focus()}function h(j,k){j.preventDefault();var l=$(k).val();var m=/^(\d{15})$/;if($.trim(l)!=""){$(k).parent().parent().parent().prev().prev().text(l);$(k).parent().parent().css("display","none")}else{$(k).parent().parent().css("display","none")}}function a(j,k){j.preventDefault();if($("#imsi_edit_body").children().length>=10){top.ModalCommon.open_for_pa(top.T.Main.Notice,"目标IMSI不能超过10个","error");return false}var m=$.trim($(k).prev().val());var n=/^(\d{15})$/;if(!n.test(m)){top.ModalCommon.open_for_pa(top.T.Main.Notice,"IMSI： "+m+"必须为15位数字","error");return false}var l=[];l.push("<tr>");l.push(' <td class="span2 center">',$("#imsi_edit_body").children().length+1,"</td>");l.push(' <td class="span3 center imsi">',m,"</td>");l.push(' <td class="span3 center imsi-status valid"><span class="label label-success">有效</span></td>');l.push(' <td class="span4 center">');l.push('     <a class="btn btn-success" href="#" data-rel="tooltip" data-original-title="恢复" onclick="IMSI_EDIT.valid(event, this)"> <i class="icon-undo white"></i></a>');l.push('     <a class="btn btn-info" href="#" data-rel="tooltip" data-original-title="编辑" onclick="IMSI_EDIT.edit(event, this)"> <i class="icon-edit white"></i></a>');l.push('     <a class="btn btn-danger" href="#" data-rel="tooltip" data-original-title="删除" onclick="IMSI_EDIT.invalid(event, this)"> <i class="icon-trash white"></i></a>');l.push('     <div class="control-group success imsi_edit" style="margin-bottom: 0px;display: none;">');l.push('         <div class="controls">');l.push('             <input type="text" style="margin: 0px;" placeholder="请输入要替换的IMSI（15位数字）" onblur="IMSI_EDIT.save(event, this)">');l.push("         </div>");l.push("     </div>");l.push(" </td>");l.push("</tr>");$("#imsi_edit_body").append(l.join(""));$('[rel="tooltip"],[data-rel="tooltip"]').tooltip({"placement":"bottom",delay:{show:400,hide:200}})}function d(k){k.preventDefault();var n="",l="";var m=/^(\d{15})$/;$("tr",$("#imsi_edit_body")).each(function(p,o){if($(".imsi-status",$(this)).hasClass("valid")){if(!m.test($.trim($(".imsi",$(this)).text()))){n+=($.trim($(".imsi",$(this)).text())+"、")}else{l+=($.trim($(".imsi",$(this)).text())+",")}}});if(n!=""){n=n.substring(0,n.length-1);top.ModalCommon.open_for_pa(top.T.Main.Notice,"IMSI： "+n+"必须为15位数字","error");return false}else{l=(l!=""?l.substring(0,l.length-1):"");var j='set TargetImsiParam:TargetImsiList="'+l+'";';top.LMT.cmdSyn(j,function(p){var o=top.LMT.parser(p);if(o.result==="000"){IMSI_EDIT.open();bindBtnEvent();top.ModalCommon.open_for_pa(top.T.Main.Notice,top.T.AlertInfo.OperationSuccess,"ok")}else{top.ModalCommon.open_for_pa(top.T.Main.Notice,top.T.AlertInfo.OperationFail,"error")}})}}return{open:g,valid:i,invalid:f,edit:c,save:h,add:a,imsi_save:d}}());